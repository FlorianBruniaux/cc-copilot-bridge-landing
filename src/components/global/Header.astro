---
import ThemeToggle from './ThemeToggle.astro'

const navLinks = [
  { href: '/#providers', label: 'Providers' },
  { href: '/#features', label: 'Features' },
  { href: '/#pricing', label: 'Copilot Quotas' },
  { href: '/#install', label: 'Install' },
  { href: '/faq/', label: 'FAQ' },
]

const currentPath = Astro.url.pathname
---

<header class="fixed top-0 left-0 right-0 z-50 border-b border-border" style="background: var(--bg-primary);">
  <div class="mx-auto max-w-content px-4">
    <div class="flex items-center justify-between h-14">
      <!-- Logo -->
      <a href="/" class="flex items-center gap-2 hover:opacity-80 transition-opacity">
        <span class="font-mono text-accent font-bold">&gt;_</span>
        <span class="text-text-primary font-semibold text-sm tracking-wide">cc-copilot-bridge</span>
      </a>

      <!-- Desktop Navigation -->
      <nav aria-label="Main navigation" class="hidden lg:flex items-center gap-5">
        {navLinks.map((link) => {
          const isActive = link.href.startsWith('/#')
            ? currentPath === '/'
            : currentPath === link.href || currentPath === link.href.replace(/\/$/, '')
          return (
            <a
              href={link.href}
              class:list={[
                'text-sm font-medium transition-colors relative',
                'after:absolute after:bottom-[-4px] after:left-0 after:h-[2px] after:bg-accent after:transition-all after:duration-300',
                isActive
                  ? 'text-text-primary after:w-0 hover:after:w-full'
                  : 'text-text-secondary hover:text-text-primary after:w-0 hover:after:w-full',
              ]}
            >
              {link.label}
            </a>
          )
        })}
      </nav>

      <!-- Actions -->
      <div class="flex items-center gap-2">
        <ThemeToggle />

        <!-- Search trigger -->
        <button
          id="search-trigger"
          aria-label="Search (Cmd+K)"
          class="hidden sm:flex items-center gap-2 px-3 py-1.5 rounded-lg border border-border text-text-muted text-sm hover:border-accent hover:text-text-secondary transition-colors"
        >
          <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true">
            <circle cx="11" cy="11" r="8" />
            <path d="m21 21-4.35-4.35" />
          </svg>
          <span>Search</span>
          <kbd class="text-xs bg-background-tertiary px-1.5 py-0.5 rounded border border-border">&#x2318;K</kbd>
        </button>

        <!-- GitHub star button -->
        <a
          href="https://github.com/FlorianBruniaux/cc-copilot-bridge"
          target="_blank"
          rel="noopener noreferrer"
          class="hidden sm:flex items-center gap-1.5 px-3 py-1.5 rounded-lg border text-sm font-medium transition-colors"
          style="background: var(--github-btn-bg); border-color: var(--github-btn-border); color: var(--github-btn-color);"
        >
          <svg class="w-4 h-4" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">
            <path d="M8 .25a.75.75 0 01.673.418l1.882 3.815 4.21.612a.75.75 0 01.416 1.279l-3.046 2.97.719 4.192a.75.75 0 01-1.088.791L8 12.347l-3.766 1.98a.75.75 0 01-1.088-.79l.72-4.194L.818 6.374a.75.75 0 01.416-1.28l4.21-.611L7.327.668A.75.75 0 018 .25z" />
          </svg>
          <span>Star</span>
        </a>

        <!-- Mobile Menu Button -->
        <button
          id="mobile-menu-toggle"
          aria-label="Toggle mobile menu"
          aria-expanded="false"
          aria-controls="mobile-menu"
          class="lg:hidden rounded-lg p-2.5 hover:bg-background-tertiary transition-colors"
        >
          <svg id="menu-icon" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
          </svg>
          <svg id="close-icon" class="w-5 h-5 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>
    </div>

    <!-- Mobile Navigation -->
    <nav id="mobile-menu" aria-label="Mobile navigation" class="hidden lg:hidden pb-4">
      {navLinks.map((link) => (
        <a
          href={link.href}
          class="block py-2 text-base font-medium transition-colors text-text-secondary hover:text-text-primary"
        >
          {link.label}
        </a>
      ))}
      <div class="flex items-center gap-3 pt-3 border-t border-border mt-2">
        <a
          href="https://github.com/FlorianBruniaux/cc-copilot-bridge"
          target="_blank"
          rel="noopener noreferrer"
          class="text-text-secondary hover:text-accent transition-colors text-sm font-medium"
        >
          GitHub
        </a>
      </div>
    </nav>
  </div>
</header>

<script>
  function initMobileMenu() {
    const toggle = document.getElementById('mobile-menu-toggle')
    const menu = document.getElementById('mobile-menu')
    const menuIcon = document.getElementById('menu-icon')
    const closeIcon = document.getElementById('close-icon')

    if (!toggle || !menu || !menuIcon || !closeIcon) return

    function closeMenu() {
      menu.classList.add('hidden')
      menuIcon.classList.remove('hidden')
      closeIcon.classList.add('hidden')
      toggle.setAttribute('aria-expanded', 'false')
    }

    function openMenu() {
      menu.classList.remove('hidden')
      menuIcon.classList.add('hidden')
      closeIcon.classList.remove('hidden')
      toggle.setAttribute('aria-expanded', 'true')
    }

    toggle.addEventListener('click', () => {
      menu.classList.contains('hidden') ? openMenu() : closeMenu()
    })

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && !menu.classList.contains('hidden')) closeMenu()
    })

    document.addEventListener('click', (e) => {
      if (!menu.classList.contains('hidden') && !menu.contains(e.target) && !toggle.contains(e.target)) {
        closeMenu()
      }
    })
  }

  initMobileMenu()
</script>
